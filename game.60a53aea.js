function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var e=globalThis,n={},i={},a=e.parcelRequire4cf8;null==a&&((a=function(t){if(t in n)return n[t].exports;if(t in i){var e=i[t];delete i[t];var a={id:t,exports:{}};return n[t]=a,e.call(a.exports,a,a.exports),a.exports}var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){i[t]=e},e.parcelRequire4cf8=a);var o=a.register;o("mDWTX",function(e,n){t(e.exports,"randomIntBetween",()=>i),t(e.exports,"clamp",()=>o),t(e.exports,"getConfigValue",()=>r),t(e.exports,"randomHexColor",()=>s),t(e.exports,"getRandomSeed",()=>h);let i=(t,e)=>Math.floor(Math.random()*(e-t)+t),a=(t,e)=>Math.random()*(e-t)+t,o=(t,e,n)=>Math.max(Math.min(t,Math.max(e,n)),Math.min(e,n)),r=t=>"number"==typeof t?t:"number"==typeof t?.min&&"number"==typeof t?.max?a(t.min,t.max):0,s=()=>"#"+(16777215*Math.random()<<0).toString(16).padStart(6,"0"),h=()=>Math.random().toString(36).slice(2)}),o("cmoHh",function(t,e){!function(t,e,n){function i(t){var e,n=this,i=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));e=i>>>0,i-=e,i*=e,e=i>>>0,i-=e,e+=4294967296*i}return(e>>>0)*23283064365386963e-26});n.next=function(){var t=2091639*n.s0+23283064365386963e-26*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(t),n.s0<0&&(n.s0+=1),n.s1-=i(t),n.s1<0&&(n.s1+=1),n.s2-=i(t),n.s2<0&&(n.s2+=1)}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new i(t),o=e&&e.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+(2097152*r()|0)*11102230246251565e-32},r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.alea=o}(0,t,"function"==typeof define&&define)}),o("euRi5",function(t,e){!function(t,e,n){function i(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new i(t),o=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,i=(t+e)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o}(0,t,"function"==typeof define&&define)}),o("hDsEw",function(t,e){!function(t,e,n){function i(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(t^t<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new i(t),o=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,i=(t+e)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o}(0,t,"function"==typeof define&&define)}),o("3J2Zm",function(t,e){!function(t,e,n){function i(t){var e=this;e.next=function(){var t,n,i=e.x,a=e.i;return t=i[a],t^=t>>>7,n=t^t<<24^((t=i[a+1&7])^t>>>10)^((t=i[a+3&7])^t>>>3)^((t=i[a+4&7])^t<<7),t=i[a+7&7],t^=t<<13,n^=t^t<<9,i[a]=n,e.i=a+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(n=0,e=""+e;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new i(t),o=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,i=(t+e)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&(o.x&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o}(0,t,"function"==typeof define&&define)}),o("6Px8M",function(t,e){!function(t,e,n){function i(t){var e=this;e.next=function(){var t,n,i=e.w,a=e.X,o=e.i;return e.w=i=i+1640531527|0,n=a[o+34&127],t=a[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=a[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,a,o,r,s=[],h=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,h=Math.max(h,e.length)),a=0,o=-32;o<h;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(r=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(r=r+1640531527|0,a=0==(n=s[127&o]^=i+r)?a+1:0);for(a>=128&&(s[127&(e&&e.length||0)]=-1),a=127,o=512;o>0;--o)i=s[a+34&127],n=s[a=a+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[a]=i^n;t.w=r,t.X=s,t.i=a}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new i(t),o=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,i=(t+e)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&(o.X&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o}(0,t,"function"==typeof define&&define)}),o("lDm0S",function(t,e){!function(t,e,n){function i(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,a=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^a,a=a-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^a,e.a=a-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new i(t),o=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,i=(t+e)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}e&&e.exports?e.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o}(0,t,"function"==typeof define&&define)}),o("kjyEk",function(t,e){});var r=a("iuB9z"),s=a("fZj6v"),h=a("84MTf"),u=a("mDWTX"),c=a("4AGbv"),l=a("2Tywo"),d={},f=a("cmoHh"),x=a("euRi5"),p=a("hDsEw"),m=a("3J2Zm"),g=a("6Px8M"),w=a("lDm0S"),v={};!function(t,e,n){var i,o="random",r=n.pow(256,6),s=n.pow(2,52),h=2*s;function u(a,u,x){var p=[],m=d(function t(e,n){var i,a=[],o=typeof e;if(n&&"object"==o)for(i in e)try{a.push(t(e[i],n-1))}catch(t){}return a.length?a:"string"==o?e:e+"\0"}((u=!0==u?{entropy:!0}:u||{}).entropy?[a,f(e)]:null==a?function(){try{var n;return i&&(n=i.randomBytes)?n=n(256):(n=new Uint8Array(256),(t.crypto||t.msCrypto).getRandomValues(n)),f(n)}catch(n){var a=t.navigator,o=a&&a.plugins;return[+new Date,t,o,t.screen,f(e)]}}():a,3),p),g=new c(p),w=function(){for(var t=g.g(6),e=r,n=0;t<s;)t=(t+n)*256,e*=256,n=g.g(1);for(;t>=h;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|g.g(4)},w.quick=function(){return g.g(4)/4294967296},w.double=w,d(f(g.S),e),(u.pass||x||function(t,e,i,a){return(a&&(a.S&&l(a,g),t.state=function(){return l(g,{})}),i)?(n[o]=t,e):t})(w,m,"global"in u?u.global:this==n,u.state)}function c(t){var e,n=t.length,i=this,a=0,o=i.i=i.j=0,r=i.S=[];for(n||(t=[n++]);a<256;)r[a]=a++;for(a=0;a<256;a++)r[a]=r[o=255&o+t[a%n]+(e=r[a])],r[o]=e;(i.g=function(t){for(var e,n=0,a=i.i,o=i.j,r=i.S;t--;)e=r[a=255&a+1],n=256*n+r[255&(r[a]=r[o=255&o+e])+(r[o]=e)];return i.i=a,i.j=o,n})(256)}function l(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var n,i=t+"",a=0;a<i.length;)e[255&a]=255&(n^=19*e[255&a])+i.charCodeAt(a++);return f(e)}function f(t){return String.fromCharCode.apply(0,t)}if(d(n.random(),e),v){v=u;try{i=a("kjyEk")}catch(t){}}else"function"==typeof define&&define.amd?define(function(){return u}):n["seed"+o]=u}("undefined"!=typeof self?self:v,[],Math),v.alea=f,v.xor128=x,v.xorwow=p,v.xorshift7=m,v.xor4096=g,v.tychei=w,d=v;var u=a("mDWTX");const C=new URLSearchParams(window.location.search),y=C.has("raceLength")?parseInt(C.get("raceLength")):30,b=C.has("seed")?C.get("seed"):(0,u.getRandomSeed)(),S=C.has("snails")?C.get("snails"):'[{ "name": "Foo", "color": "#ff0000", "number": 1 }]',k=new class{constructor(t){if(this.app=new r.Application,this.stage=this.app.stage,this.snails=[],this.raceStarted=!1,this.raceComplete=!1,this.showResults=!1,this.raceLength=600*t.raceLength,this.cameraContainer=new s.CameraContainer(this.raceLength,window.innerHeight),this.elapsedMS=this.tickCount=0,this.tickLengthMS=1e3,this.onCompleteCallback=t.onComplete,this.finishLineX=0,this.finishers=[],void 0!==t.randomSeed){var e;((e=d)&&e.__esModule?e.default:e)(t.randomSeed,{global:!0})}t.snails.forEach(t=>{this.snails.push(new h.Snail(t))})}async load(){let t=[];this.snails.forEach(e=>{let n=(0,u.randomIntBetween)(1,6);t.push(e.load(n))}),t.push((0,r.Assets).load({alias:"cloudLayer",src:"./cloudLayer1.png"})),t.push((0,r.Assets).load({alias:"backgroundMountains",src:"./mountains.png"})),t.push((0,r.Assets).load({alias:"hills",src:"./hills.png"})),t.push((0,r.Assets).load({alias:"groundLayer",src:"./groundLayer1.png"})),t.push((0,r.Assets).load({alias:"cloud1",src:"./cloud1.png"})),t.push((0,r.Assets).load({alias:"cloud2",src:"./cloud2.png"})),t.push((0,r.Assets).load({alias:"cloud3",src:"./cloud3.png"})),t.push((0,r.Assets).load({alias:"cloud4",src:"./cloud4.png"})),t.push((0,r.Assets).load({alias:"signage",src:"./signage.png"})),t.push((0,r.Assets).load({alias:"track",src:"./track.png"})),await Promise.all(t)}init(t){this.app.init({resizeTo:window,backgroundColor:12052474,sharedTicker:!0,...t}).then(()=>{document.body.appendChild(this.app.canvas),this.finishLineX=this.raceLength+.75*this.app.canvas.width,this.stage.addChild(this.cameraContainer),[{textureName:"cloudLayer",zIndex:.01,x:"tiled",y:0},{textureName:"backgroundMountains",zIndex:.05,x:"tiled",y:10,tint:14543842},{textureName:"hills",zIndex:.075,x:"tiled",y:100,tint:11523774},{textureName:"groundLayer",zIndex:.1,x:"tiled",y:175,tint:8239720},{textureName:"cloud1",zIndex:.11,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.11},y:{min:-25,max:200}},{textureName:"cloud2",zIndex:.22,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.22},y:{min:-25,max:200}},{textureName:"cloud3",zIndex:.33,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.33},y:{min:-25,max:200}},{textureName:"cloud4",zIndex:.44,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.44},y:{min:-25,max:200}},{textureName:"signage",zIndex:1,x:"tiled",y:240},{textureName:"track",zIndex:1,x:"tiled",y:"tiled",offsetY:400}].forEach(t=>{let e=(0,r.Texture).from(t.textureName),n=new r.Point(1);"tiled"===t.x&&(n.x=Math.ceil(this.app.canvas.width/e.width+this.cameraContainer.fullWidth/e.width*(0,u.getConfigValue)(t.zIndex))+1),"tiled"===t.y&&(n.y=Math.ceil(this.app.canvas.height/e.height+this.cameraContainer.fullHeight/e.height*(0,u.getConfigValue)(t.zIndex))+1);let i=new s.ParallaxChild;for(let a=0;a<n.x;a++){let o=(0,r.Sprite).from(e),s="tiled"===t.x?o.width*a:(0,u.getConfigValue)(t.x);if("tiled"===t.y){o.position.set(s+(0,u.getConfigValue)(t.offsetX),(0,u.getConfigValue)(t.offsetY)),o.tint=t.tint??16777215,i.addChild(o);for(let a=1;a<n.y;a++){let n=(0,r.Sprite).from(e),h=o.height*a;n.position.set(s+(0,u.getConfigValue)(t.offsetX),h+(0,u.getConfigValue)(t.offsetY)),n.tint=t.tint??16777215,i.addChild(n)}}else{let e=(0,u.getConfigValue)(t.y);o.position.set(s+(0,u.getConfigValue)(t.offsetX),e+(0,u.getConfigValue)(t.offsetY)),o.tint=t.tint??16777215,i.addChild(o)}}this.cameraContainer.addChildAtZ(i,(0,u.getConfigValue)(t.zIndex))});let t=new s.ParallaxChild,e=new(0,r.Graphics)().moveTo(350,400).lineTo(300,this.app.canvas.height).stroke({color:16777215,width:10});t.addChild(e),this.cameraContainer.addChildAtZ(t,1);let n=new s.ParallaxChild,i=new(0,r.Graphics)().moveTo(this.finishLineX,400).lineTo(this.finishLineX+100,this.app.canvas.height).stroke({color:16777215,width:10});n.addChild(i),this.cameraContainer.addChildAtZ(n,1),this.snails.reverse().forEach((t,e)=>{this.cameraContainer.addChildAtZ(t.create()),t.updatePositionBy(150+-10*e,400-.8*t.container.height+e*((this.app.canvas.height-400)/this.snails.length),!0)}),(0,r.Ticker).shared.add(t=>this.update(t)),this.startCountdownText(5,()=>this.raceStarted=!0)})}startCountdownText(t,e){let n=new r.Text({text:t.toString(),style:{fill:3===t?16711680:2===t?16746496:1===t?65280:16777215,fontSize:500,fontWeight:"bold",stroke:{color:0,width:5,join:"round"}}});return n.anchor.set(.5),n.position.set(this.app.canvas.width/2,this.app.canvas.height/2),this.stage.addChild(n),(0,c.default).to(n,{duration:1,alpha:0,ease:l.Sine.easeIn}),(0,c.default).fromTo(n.scale,{x:0,y:0},{duration:1,x:1,y:1,ease:l.Sine.easeOut,onComplete:()=>{this.stage.removeChild(n),1===t?e():this.startCountdownText(t-1,e)}})}finishRace(){this.showResults=!0;let t=new r.Text({text:"FIN",style:{fill:16777215,fontSize:500,fontWeight:"bold",stroke:{color:0,width:5,join:"round"}}});t.anchor.set(.5),t.position.set(this.app.canvas.width/2,this.app.canvas.height/2),this.stage.addChild(t),setTimeout(()=>{this.onCompleteCallback&&this.onCompleteCallback(this.finishers)},2e3)}update(t){if(!this.showResults){this.tickCount+=t.elapsedMS,this.raceStarted&&(this.elapsedMS+=t.elapsedMS,this.tickCount>this.tickLengthMS&&(this.tickCount=0,this.snails.forEach(t=>{t.changeSpeed()})),this.snails.forEach(e=>{e.update(t.deltaTime),!(e.container.originalPosition.x+e.container.width/3>this.finishLineX)||e.finished||(e.finished=!0,this.finishers.push({...e.config,time:this.elapsedMS,bodyAssetNum:e.bodyAssetNum}),this.raceComplete||this.finishers.length!==this.snails.length||(this.raceComplete=!0,setTimeout(()=>this.finishRace(),2e3)))}));let e=this.snails.reduce((t,e)=>t.container.originalPosition.x>=e.container.originalPosition.x?t:e,this.snails[0]);this.cameraContainer.moveCameraTo(e.container.originalPosition.x-this.app.canvas.width/2,0)}}}({raceLength:y,randomSeed:b,snails:JSON.parse(S),onComplete:t=>{let e=t.map(t=>({...t,name:encodeURIComponent(t.name),color:encodeURIComponent(t.color),time:t.time}));window.location.href=`./finished.html?snails=${JSON.stringify(e)}`}});k.load().then(()=>{k.init()});
//# sourceMappingURL=game.60a53aea.js.map
