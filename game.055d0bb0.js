function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t=globalThis,n={},i={},a=t.parcelRequire4cf8;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){i[e]=t},t.parcelRequire4cf8=a);var o=a.register;o("cmoHh",function(e,t){!function(e,t,n){function i(e){var t,n=this,i=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return(t>>>0)*23283064365386963e-26});n.next=function(){var e=2091639*n.s0+23283064365386963e-26*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(e),n.s0<0&&(n.s0+=1),n.s1-=i(e),n.s1<0&&(n.s1+=1),n.s2-=i(e),n.s2<0&&(n.s2+=1)}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new i(e),o=t&&t.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+(2097152*r()|0)*11102230246251565e-32},r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o}(0,e,"function"==typeof define&&define)}),o("euRi5",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new i(e),o=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o}(0,e,"function"==typeof define&&define)}),o("hDsEw",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(e^e<<1))|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new i(e),o=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o}(0,e,"function"==typeof define&&define)}),o("3J2Zm",function(e,t){!function(e,t,n){function i(e){var t=this;t.next=function(){var e,n,i=t.x,a=t.i;return e=i[a],e^=e>>>7,n=e^e<<24^((e=i[a+1&7])^e>>>10)^((e=i[a+3&7])^e>>>3)^((e=i[a+4&7])^e<<7),e=i[a+7&7],e^=e<<13,n^=e^e<<9,i[a]=n,t.i=a+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(n=0,t=""+t;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),o=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&(o.x&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o}(0,e,"function"==typeof define&&define)}),o("6Px8M",function(e,t){!function(e,t,n){function i(e){var t=this;t.next=function(){var e,n,i=t.w,a=t.X,o=t.i;return t.w=i=i+1640531527|0,n=a[o+34&127],e=a[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[o]=n^e,t.i=o,n+(i^i>>>16)|0},function(e,t){var n,i,a,o,r,s=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),a=0,o=-32;o<l;++o)t&&(i^=t.charCodeAt((o+32)%t.length)),0===o&&(r=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(r=r+1640531527|0,a=0==(n=s[127&o]^=i+r)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,o=512;o>0;--o)i=s[a+34&127],n=s[a=a+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[a]=i^n;e.w=r,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),o=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&(o.X&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o}(0,e,"function"==typeof define&&define)}),o("lDm0S",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new i(e),o=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},r.int32=n.next,r.quick=r,o&&("object"==typeof o&&a(o,n),r.state=function(){return a(n,{})}),r}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o}(0,e,"function"==typeof define&&define)}),o("kjyEk",function(e,t){}),o("Ah4p2",function(t,n){e(t.exports,"RACE_LENGTH_KEY",()=>r),e(t.exports,"RaceLength",()=>s);var i=a("ayMG0"),o=a("b5ORo");let r="raceLength",s=()=>{let[e,t]=(0,o.default)(r,30);return(0,i.jsxs)("div",{className:"raceLength",children:[(0,i.jsx)("h2",{children:"Race length"}),(0,i.jsx)("input",{id:"raceLength",name:"raceLength",type:"range",min:"10",max:"60",value:e,onChange:e=>{e.preventDefault(),t(e.target.value)}}),(0,i.jsxs)("output",{children:["~",e," seconds"]})]})}}),o("joO0Q",function(t,n){e(t.exports,"SEED_KEY",()=>s),e(t.exports,"Seed",()=>l);var i=a("ayMG0"),o=a("mDWTX"),r=a("b5ORo");let s="seed",l=()=>{let[e,t]=(0,r.default)(s,(0,o.getRandomSeed)());return(0,i.jsxs)("div",{className:"seed",children:[(0,i.jsx)("h2",{children:"Seed"}),(0,i.jsx)("input",{type:"string",onChange:e=>{e.preventDefault(),t(e.target.value)},value:e}),(0,i.jsx)("button",{onClick:()=>{t((0,o.getRandomSeed)())},children:"Randomize"})]})}}),o("9NY5T",function(t,n){e(t.exports,"SNAILS_KEY",()=>l),e(t.exports,"Snails",()=>c);var i=a("ayMG0"),o=a("acw62"),r=a("b5ORo"),s=a("mDWTX");let l="snails",c=()=>{let[e,t]=(0,r.default)(l,[]),[n,a]=(0,o.useState)(""),[c,u]=(0,o.useState)((0,s.randomHexColor)()),h=(n,i)=>{let o={name:n.length?encodeURIComponent(n):encodeURIComponent(`Snail ${e.length+1}`),color:encodeURIComponent(i),number:e.length+1};t([...e,o]),a(""),u((0,s.randomHexColor)())},d=n=>{let i=e.filter(e=>e.number!==n);i.forEach((e,t)=>{e.number=t+1}),t(i)},f=e.length>=8;return(0,i.jsxs)("div",{className:"snails",children:[(0,i.jsx)("h2",{children:"Snails"}),(0,i.jsxs)("div",{className:"snails__add",children:[(0,i.jsx)("input",{type:"text",placeholder:"Name",onChange:e=>{a(e.target.value)},value:n}),(0,i.jsx)("input",{type:"color",onChange:e=>{u(e.target.value)},value:c}),(0,i.jsx)("button",{disabled:f,onClick:()=>h(n,c),children:"Add snail"})]}),(0,i.jsx)("ul",{className:"snails__list",children:e.map(e=>(0,i.jsxs)("li",{children:[e.number,": ",(0,i.jsx)("span",{style:{color:decodeURIComponent(e.color)},children:decodeURIComponent(e.name)})," ",(0,i.jsx)("span",{className:"snails__list__delete",onClick:()=>d(e.number),children:"X"})]},e.number))})]})}});var r=a("iuB9z"),s=a("fZj6v"),l=a("84MTf"),c=a("mDWTX"),u=a("4AGbv"),h=a("2Tywo"),d={},f=a("cmoHh"),p=a("euRi5"),x=a("hDsEw"),m=a("3J2Zm"),g=a("6Px8M"),C=a("lDm0S"),v={};!function(e,t,n){var i,o="random",r=n.pow(256,6),s=n.pow(2,52),l=2*s;function c(a,c,p){var x=[],m=d(function e(t,n){var i,a=[],o=typeof t;if(n&&"object"==o)for(i in t)try{a.push(e(t[i],n-1))}catch(e){}return a.length?a:"string"==o?t:t+"\0"}((c=!0==c?{entropy:!0}:c||{}).entropy?[a,f(t)]:null==a?function(){try{var n;return i&&(n=i.randomBytes)?n=n(256):(n=new Uint8Array(256),(e.crypto||e.msCrypto).getRandomValues(n)),f(n)}catch(n){var a=e.navigator,o=a&&a.plugins;return[+new Date,e,o,e.screen,f(t)]}}():a,3),x),g=new u(x),C=function(){for(var e=g.g(6),t=r,n=0;e<s;)e=(e+n)*256,t*=256,n=g.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return C.int32=function(){return 0|g.g(4)},C.quick=function(){return g.g(4)/4294967296},C.double=C,d(f(g.S),t),(c.pass||p||function(e,t,i,a){return(a&&(a.S&&h(a,g),e.state=function(){return h(g,{})}),i)?(n[o]=e,t):e})(C,m,"global"in c?c.global:this==n,c.state)}function u(e){var t,n=e.length,i=this,a=0,o=i.i=i.j=0,r=i.S=[];for(n||(e=[n++]);a<256;)r[a]=a++;for(a=0;a<256;a++)r[a]=r[o=255&o+e[a%n]+(t=r[a])],r[o]=t;(i.g=function(e){for(var t,n=0,a=i.i,o=i.j,r=i.S;e--;)t=r[a=255&a+1],n=256*n+r[255&(r[a]=r[o=255&o+t])+(r[o]=t)];return i.i=a,i.j=o,n})(256)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,i=e+"",a=0;a<i.length;)t[255&a]=255&(n^=19*t[255&a])+i.charCodeAt(a++);return f(t)}function f(e){return String.fromCharCode.apply(0,e)}if(d(n.random(),t),v){v=c;try{i=a("kjyEk")}catch(e){}}else"function"==typeof define&&define.amd?define(function(){return c}):n["seed"+o]=c}("undefined"!=typeof self?self:v,[],Math),v.alea=f,v.xor128=p,v.xorwow=x,v.xorshift7=m,v.xor4096=g,v.tychei=C,d=v;var w=a("9Blbd"),y=a("jXtmt"),S=a("Ah4p2"),b=a("joO0Q"),N=a("9NY5T");const A=new URLSearchParams(window.location.search),j=A.get(y.RACE_NAME_KEY),E=A.get(w.RACE_SPONSOR_NAME_KEY),L=A.get(w.RACE_SPONSOR_LOGO_KEY),k=A.get(b.SEED_KEY),R=A.has(S.RACE_LENGTH_KEY)?parseInt(A.get(S.RACE_LENGTH_KEY)):30,_=A.has(N.SNAILS_KEY)?A.get(N.SNAILS_KEY):'[{ "name": "Foo", "color": "#ff0000", "number": 1 }]',T=new class{constructor(e){if(this.app=new r.Application,this.stage=this.app.stage,this.snails=[],this.raceStarted=!1,this.raceComplete=!1,this.showResults=!1,this.raceDetails={length:600*e.raceLength,raceName:e.raceName||void 0,raceSponsorName:e.raceSponsorName||void 0,raceSponsorLogo:e.raceSponsorLogo||void 0},this.cameraContainer=new s.CameraContainer(this.raceDetails.length,window.innerHeight),this.elapsedMS=this.tickCount=0,this.tickLengthMS=1e3,this.onCompleteCallback=e.onComplete,this.finishLineX=0,this.finishers=[],null!==e.randomSeed){var t;((t=d)&&t.__esModule?t.default:t)(e.randomSeed,{global:!0})}e.snails.forEach(e=>{this.snails.push(new l.Snail(e))})}async load(){let e=[];this.snails.forEach(t=>{let n=(0,c.randomIntBetween)(1,6);e.push(t.load(n))}),e.push((0,r.Assets).load({alias:"Super Lobster",src:"./super_lobster.ttf"})),e.push((0,r.Assets).load({alias:"cloudLayer",src:"./cloudLayer1.png"})),e.push((0,r.Assets).load({alias:"backgroundMountains",src:"./mountains.png"})),e.push((0,r.Assets).load({alias:"hills",src:"./hills.png"})),e.push((0,r.Assets).load({alias:"groundLayer",src:"./groundLayer1.png"})),e.push((0,r.Assets).load({alias:"cloud1",src:"./cloud1.png"})),e.push((0,r.Assets).load({alias:"cloud2",src:"./cloud2.png"})),e.push((0,r.Assets).load({alias:"cloud3",src:"./cloud3.png"})),e.push((0,r.Assets).load({alias:"cloud4",src:"./cloud4.png"})),e.push((0,r.Assets).load({alias:"signage",src:"./signage.png"})),e.push((0,r.Assets).load({alias:"track",src:"./track.png"})),await Promise.all(e)}init(e){this.app.init({resizeTo:window,backgroundColor:12052474,sharedTicker:!0,...e}).then(()=>{if(document.body.appendChild(this.app.canvas),this.finishLineX=this.raceDetails.length+.75*this.app.canvas.width,this.stage.addChild(this.cameraContainer),[{textureName:"cloudLayer",zIndex:.01,x:"tiled",y:0},{textureName:"backgroundMountains",zIndex:.05,x:"tiled",y:10,tint:14543842},{textureName:"hills",zIndex:.075,x:"tiled",y:100,tint:11523774},{textureName:"groundLayer",zIndex:.1,x:"tiled",y:175,tint:8239720},{textureName:"cloud1",zIndex:.11,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.11},y:{min:-50,max:100}},{textureName:"cloud2",zIndex:.22,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.22},y:{min:-50,max:100}},{textureName:"cloud3",zIndex:.33,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.33},y:{min:-50,max:100}},{textureName:"cloud4",zIndex:.44,x:{min:0,max:(this.cameraContainer.fullWidth+this.app.canvas.width)*.44},y:{min:-50,max:100}},{textureName:"signage",zIndex:1,x:"tiled",y:240},{textureName:"track",zIndex:1,x:"tiled",y:"tiled",offsetY:400}].forEach(e=>{let t=(0,r.Texture).from(e.textureName),n=new r.Point(1);"tiled"===e.x&&(n.x=Math.ceil(this.app.canvas.width/t.width+this.cameraContainer.fullWidth/t.width*(0,c.getConfigValue)(e.zIndex))+1),"tiled"===e.y&&(n.y=Math.ceil(this.app.canvas.height/t.height+this.cameraContainer.fullHeight/t.height*(0,c.getConfigValue)(e.zIndex))+1);let i=new s.ParallaxChild;for(let a=0;a<n.x;a++){let o=(0,r.Sprite).from(t),s="tiled"===e.x?o.width*a:(0,c.getConfigValue)(e.x);if("tiled"===e.y){o.position.set(s+(0,c.getConfigValue)(e.offsetX),(0,c.getConfigValue)(e.offsetY)),o.tint=e.tint??16777215,i.addChild(o);for(let a=1;a<n.y;a++){let n=(0,r.Sprite).from(t),l=o.height*a;n.position.set(s+(0,c.getConfigValue)(e.offsetX),l+(0,c.getConfigValue)(e.offsetY)),n.tint=e.tint??16777215,i.addChild(n)}}else{let t=(0,c.getConfigValue)(e.y);o.position.set(s+(0,c.getConfigValue)(e.offsetX),t+(0,c.getConfigValue)(e.offsetY)),o.tint=e.tint??16777215,i.addChild(o)}}this.cameraContainer.addChildAtZ(i,(0,c.getConfigValue)(e.zIndex))}),this.raceDetails.raceName||this.raceDetails.raceSponsorName){let e=new r.Text({text:`${this.raceDetails.raceName??""}${this.raceDetails.raceName&&this.raceDetails.raceSponsorName?" sponsored by ":""}${this.raceDetails.raceSponsorName??""}`,style:{fill:14540253,fontFamily:"Super Lobster",fontSize:120,fontWeight:"bold",stroke:{color:16933,width:10,join:"round"}}}),t=new s.ParallaxChild,n=Math.floor(this.finishLineX/(2*e.width));for(let i=1;i<n+1;i++){let a=new r.Text({text:e.text,style:e.style});a.position.set(this.finishLineX/(n+1)*i-a.width/2,235),t.addChild(a)}this.cameraContainer.addChildAtZ(t,1)}let e=new s.ParallaxChild,t=new(0,r.Graphics)().moveTo(350,400).lineTo(300,this.app.canvas.height).stroke({color:16777215,width:10});e.addChild(t),this.cameraContainer.addChildAtZ(e,1);let n=new s.ParallaxChild,i=new(0,r.Graphics)().moveTo(this.finishLineX,400).lineTo(this.finishLineX+100,this.app.canvas.height).stroke({color:16777215,width:10});n.addChild(i),this.cameraContainer.addChildAtZ(n,1),this.snails.reverse().forEach((e,t)=>{this.cameraContainer.addChildAtZ(e.create()),e.updatePositionBy(150+-10*t,400-.8*e.container.height+t*((this.app.canvas.height-400)/this.snails.length),!0)}),(0,r.Ticker).shared.add(e=>this.update(e)),this.startCountdownText(5,()=>this.raceStarted=!0)})}startCountdownText(e,t){let n=new r.Text({text:e.toString(),style:{fill:3===e?16711680:2===e?16746496:1===e?65280:16777215,fontSize:500,fontWeight:"bold",stroke:{color:0,width:5,join:"round"}}});return n.anchor.set(.5),n.position.set(this.app.canvas.width/2,this.app.canvas.height/2),this.stage.addChild(n),(0,u.default).to(n,{duration:1,alpha:0,ease:h.Sine.easeIn}),(0,u.default).fromTo(n.scale,{x:0,y:0},{duration:1,x:1,y:1,ease:h.Sine.easeOut,onComplete:()=>{this.stage.removeChild(n),1===e?t():this.startCountdownText(e-1,t)}})}finishRace(){this.showResults=!0,setTimeout(()=>{this.onCompleteCallback&&this.onCompleteCallback(this.finishers,this.raceDetails)},250)}update(e){if(!this.showResults){this.tickCount+=e.elapsedMS,this.raceStarted&&(this.elapsedMS+=e.elapsedMS,this.tickCount>this.tickLengthMS&&(this.tickCount=0,this.snails.forEach(e=>{e.changeSpeed()})),this.snails.forEach(t=>{t.update(e.deltaTime),!(t.container.originalPosition.x+t.container.width/3>this.finishLineX)||t.finished||(t.finished=!0,this.finishers.push({...t.config,time:this.elapsedMS,bodyAssetNum:t.bodyAssetNum}),this.raceComplete||this.finishers.length!==this.snails.length||(this.raceComplete=!0,setTimeout(()=>this.finishRace(),1250)))}));let t=this.snails.reduce((e,t)=>e.container.originalPosition.x>=t.container.originalPosition.x?e:t,this.snails[0]);this.cameraContainer.moveCameraTo(t.container.originalPosition.x-this.app.canvas.width/2,0)}}}({raceName:j,raceSponsorName:E,raceSponsorLogo:L,raceLength:R,randomSeed:k,snails:JSON.parse(_),onComplete:(e,t)=>{let n=e.map(e=>({...e,name:encodeURIComponent(e.name),color:encodeURIComponent(e.color),time:e.time})),i=`./finished.html?snails=${JSON.stringify(n)}`;i+="&"+Object.entries(t).filter(([e,t])=>!!t).map(([e,t])=>`${e}=${t}`).join("&"),window.location.href=i}});T.load().then(()=>{T.init()});
//# sourceMappingURL=game.055d0bb0.js.map
